% ---------------------------------------------------------------------------- %

\newif\ifonlyshowrequsr

% suppress missing item errors
\makeatletter
\patchcmd\endtrivlist
    {\if@newlist \@noitemerr \global\@newlistfalse \fi}
    {}
    {}{}
\patchcmd\endtrivlist
    {\@endparenv}
    {\if@newlist \@endpefalse \global\@newlistfalse \else \@endparenv \fi}
    {}{}
\makeatother

\newcommand{\labelifnotempty}[1]{%
  \if\relax\detokenize{#1}\relax \else \label{#1} \fi%
  }

\newcounter{counterrequser}

\newlist{listrequsr}{enumerate}{1}
\setlist[listrequsr]{nosep}
\setlist[listrequsr,1]{
  label=U.\arabic*.,
  ref=U.\arabic*,
  leftmargin=\widthof{\quad U.99.},
  before=\setcounter{listrequsri}{\value{counterrequser}},
  after=\setcounter{counterrequser}{\value{listrequsri}}
  }

\newlist{listreqsysfunc}{enumerate}{1}
\setlist[listreqsysfunc]{nosep}
\setlist[listreqsysfunc,1]{
  label=SF.\arabic{counterrequser}.\arabic*.,
  ref=SF.\arabic{counterrequser}.\arabic*,
  leftmargin=\widthof{\quad SF.99.9.},
  before=\setcounter{listrequsri}{\value{counterrequser}},
  after=\setcounter{counterrequser}{\value{listrequsri}}
  }

\newlist{requisitosnaofuncionais}{enumerate}{1}
\setlist[requisitosnaofuncionais]{nosep}
\setlist[requisitosnaofuncionais,1]{
  label=SNF.\arabic*.,
  ref=SNF.\arabic*,
  leftmargin=\widthof{\quad SNF.99.}
  }

\newenvironment{requisitos}[1]{%
  \textbf{#1.}%
  \ifonlyshowrequsr%
    \begin{listrequsr}%
  \else%
  \fi%
  }{%
  \ifonlyshowrequsr%
    \end{listrequsr}%
  \else%
  \fi%
  }

\newenvironment{requsr}[2]{%
  \ifonlyshowrequsr%
    \item{} #2%
    \labelifnotempty{#1}%
  \else%
    \addtocounter{counterrequser}{1}%
    \begin{listreqsysfunc}%
  \fi%
  }{%
  \ifonlyshowrequsr%
  \else%
    \end{listreqsysfunc}%
  \fi%
  }
  
\newcommand{\reqsys}[2]{%
  \ifonlyshowrequsr%
  \else%
    \item{} #2%
    \labelifnotempty{#1}%
  \fi%
  }

\newcommand{\reqsysnf}[2]{%
  \item{} #2%
  \labelifnotempty{#1}%
  }

% ---------------------------------------------------------------------------- %
