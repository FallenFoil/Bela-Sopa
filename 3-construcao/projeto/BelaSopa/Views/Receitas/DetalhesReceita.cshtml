@model (Receita Receita, bool Favorita)
@{
    Layout = "_LayoutAutenticado";
    ViewData["Title"] = Model.Receita.Nome;
}

<div class="container">
    <div class="row">
        <div class="col-sm-8">
            <img src="data:image/*;base64,@Util.BytesToBase64(Model.Receita.Imagem)"
                 alt="@Model.Receita.Nome"
                 style="max-width: 100%; object-fit: cover;" />
            <a asp-controller="Receitas" asp-action="ToggleFavorito" asp-route-id="@Model.Receita.ReceitaId">
                @if (@Model.Favorita) {
                    //Dentro Favoritos
                    <i class="fas fa-star" style="color:gold;position:absolute; left:7%; top:5%; font-size:200%"></i>
                } else {
                    //Dos Favoritos
                    <i class="far fa-star" style="color:gold;position:absolute; left:7%; top:5%; font-size:200%"></i>
                }
            </a>
        </div>
        <div class="col-sm-4" style="text-align:center;">
            <h4>@Model.Receita.Nome</h4>
            @if (Model.Receita.Dificuldade == Dificuldade.Facil)
            {
            <span><i class="fas fa-signal" style="color: green;"></i>Fácil</span>
            }
            @if (Model.Receita.Dificuldade == Dificuldade.Media)
            {
            <span><i class="fas fa-signal" style="color: orange;"></i>Média</span>
            }
            @if (Model.Receita.Dificuldade == Dificuldade.Dificil)
            {
            <span><i class="fas fa-signal" style="color: red;"></i>Difícil</span>
            }
            <span style="margin-left:5%;">@Model.Receita.MinutosPreparacao min <i class="fas fa-clock"></i></span>
            <span style="margin-left:5%;">@Model.Receita.NumeroDoses doses</span>
        </div>
    </div>
</div>

<p>Etiquetas:</p>

<ul>
    @foreach (var etiqueta in Model.Receita.ReceitaEtiqueta)
    {
        <li>
            @etiqueta.Etiqueta.Nome
        </li>
    }
</ul>

<p class="font-italic">@Model.Receita.Descricao</p>

<img
    src="data:image/*;base64,@Util.BytesToBase64(Model.Receita.Imagem)"
    alt=""
    style="max-width: 100%; object-fit: cover;"
    />

<hr />
<h4>Ingredientes</h4>

<table class="table">
    <thead class="thead-light">
        <tr>
            <th scope="col"></th>
            <th scope="col">Quantidade</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var utilizacaoIngrediente in Model.Receita.UtilizacoesIngredientes)
        {
            <tr>
                <td>
                    @if (utilizacaoIngrediente.Ingrediente != null)
                    {
                        <a
                            asp-controller="Ingredientes"
                            asp-action="Detalhes"
                            asp-route-id="@utilizacaoIngrediente.Ingrediente.IngredienteId"
                            >
                            @utilizacaoIngrediente.Nome
                        </a>
                    }
                    else
                    {
                        <text>@utilizacaoIngrediente.Nome</text>
                    }
                </td>
                <td>@utilizacaoIngrediente.Quantidade</td>
            </tr>
        }
    </tbody>
</table>

<hr />
<h4>Valores nutricionais</h4>

<table class="table">
    <thead class="thead-light">
        <tr>
            <th scope="col"></th>
            <th scope="col">Dose</th>
            <th scope="col">% do VDR adulto</th>
        </tr>
    </thead>
    <tbody>
        @{ var i = 0;}
        @foreach (var valor in Model.Receita.ValoresNutricionais)
        {
            if (i == 0)
            {
                <tr>
                    <td>@valor.Nome</td>
                    <td>@valor.Dose</td>
                    <td>
                        @if (@valor.PercentagemVdrAdulto != null)
                        {@valor.PercentagemVdrAdulto<text>%</text>}
                </td>
            </tr>
            i++;
        }
        else
        {
            <tr id="ValoresNut">
                <td>@valor.Nome</td>
                <td>@valor.Dose</td>
                <td>@if (@valor.PercentagemVdrAdulto != null)
                {@valor.PercentagemVdrAdulto<text>%</text>}</td>
            </tr>
                i--;
            }
        }
    </tbody>
</table>

<hr />
<h4>Passos</h4>

<ul>
    @foreach (var processo in Model.Receita.Processos)
    {
        <li>
            <ul>
                @foreach (var tarefa in processo.Tarefas)
                {
                    <li>
                        @foreach ((string controller, int? id, string texto) in tarefa.GetPartesTexto())
                        {
                            if (controller == null)
                            {
                                <text>@texto</text>
                            }
                            else
                            {
                                <a asp-controller="@controller" asp-action="Detalhes" asp-route-id="@id">@texto</a>
                            }
                        }
                    </li>
                }
            </ul>
        </li>
    }
</ul>
